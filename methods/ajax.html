<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>ajax | Umbrella - にほんご。</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta property="og:title" content="ajax | Umbrella - にほんご。"><meta property="og:url"><meta property="og:type" content="article"><link rel="icon" href="https://tr.you84815.space/umbrella/favicon.ico"><link rel="stylesheet" href="../css/main.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-106478577-1', 'auto');</script></head><body><div id="container"><header><div class="icon"><a class="no-barba" href="https://tr.you84815.space/"><svg width="16" height="16"><rect width="16" height="16" fill="#e0e0e0"></rect></svg></a></div><div class="navi_toggle" onclick="toggleMenu()"><svg id="menu_close" width="24" height="24" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg><svg id="menu_open" width="24" height="24" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"></path><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></div><div class="title">Umbrella - <a class="no-barba" href="https://tr.you84815.space/">にほんご。</a></div></header><div class="navi" id="navi"><ul class="menu"><li><a class="index" href="../index.html">Home</a></li><li><a class="introduction" href="../introduction.html">Introduction</a></li><li><a class="overview" href="../overview.html">Overview</a></li><li><span onclick="toggleNaviSubMenu('navi_properties')">Properties</span><ul class="hidden" id="navi_properties"><li><a href="../properties/length.html">.length</a></li></ul></li><li><span onclick="toggleNaviSubMenu('navi_methods')">Methods</span><ul id="navi_methods"><li><a href="../methods/add-class.html">.addClass()</a></li><li><a href="../methods/after.html">.after()</a></li><li><a href="../methods/append.html">.append()</a></li><li><a href="../methods/array.html">.array()</a></li><li><a href="../methods/attr.html">.attr()</a></li><li><a href="../methods/before.html">.before()</a></li><li><a href="../methods/children.html">.children()</a></li><li><a href="../methods/clone.html">.clone()</a></li><li><a href="../methods/closest.html">.closest()</a></li><li><a href="../methods/data.html">.data()</a></li><li><a href="../methods/each.html">.each()</a></li><li><a href="../methods/empty.html">.empty()</a></li><li><a href="../methods/filter.html">.filter()</a></li><li><a href="../methods/find.html">.find()</a></li><li><a href="../methods/first.html">.first()</a></li><li><a href="../methods/handle.html">.handle()</a></li><li><a href="../methods/has-class.html">.hasClass()</a></li><li><a href="../methods/html.html">.html()</a></li><li><a href="../methods/is.html">.is()</a></li><li><a href="../methods/last.html">.last()</a></li><li><a href="../methods/map.html">.map()</a></li><li><a href="../methods/not.html">.not()</a></li><li><a href="../methods/off.html">.off()</a></li><li><a href="../methods/on.html">.on()</a></li><li><a href="../methods/parent.html">.parent()</a></li><li><a href="../methods/prepend.html">.prepend()</a></li><li><a href="../methods/remove.html">.remove()</a></li><li><a href="../methods/remove-class.html">.removeClass()</a></li><li><a href="../methods/replace.html">.replace()</a></li><li><a href="../methods/scroll.html">.scroll()</a></li><li><a href="../methods/serialize.html">.serialize()</a></li><li><a href="../methods/siblings.html">.siblings()</a></li><li><a href="../methods/size.html">.size()</a></li><li><a href="../methods/text.html">.text()</a></li><li><a href="../methods/toggle-class.html">.toggleClass()</a></li><li><a href="../methods/trigger.html">.trigger()</a></li><li><a href="../methods/wrap.html">.wrap()</a></li></ul></li></ul></div><div id="content"><div id="main"><div id="barba-wrapper"><div class="barba-container"><h1>ajax</h1><div id="update_date"><span>更新日: 2018.09.10
</span></div><h2>.ajax([done], [before])</h2><p>フォームを送信した時に、マッチした全てのフォームを、
送信した時と同じaction、method、valueでajax送信するようにします。</p><blockquote>このメソッドはフォームを送信せず、
(ユーザーからの<a class="no-barba" href="./trigger.html"><code>.trigger()</code></a>によって)フォームを処理するだけです。</blockquote><br><h3>パラメータ</h3><dl><dt><b>done</b><span class="type"> : function</span></dt><dd>リクエストが完了した時に呼び出される関数を指定します。
オプションです。<br>第1引数には、エラーがあれば、エラーが入ります。<br>第2引数は送信データです。
JSONであればJSONが入り、JSONでなければ文字列が入ります。<br>第3引数はリクエストのオブジェクトが入ります。<pre><code><span class="hljs-keyword">var</span> done = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, body, xhr</span>)</span>{};</code></pre></dd><dt><b>before</b><span class="type"> : function</span></dt><dd>リクエスト送信前に呼び出される関数を指定します。
複数データをリアルタイムで処理するのに便利です。
オプションです。<pre><code><span class="hljs-keyword">var</span> before = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xhr</span>)</span>{};</code></pre></dd></dl><pre><code>.ajax(done, before);</code></pre><br><h3>戻り値</h3><dl><dt>undefined。</dt><dd>返された値は使用しないでください。
(場合によっては、他処理のpromiseの可能性があります。)</dd></dl><br><h3>例</h3><p>ニュースレターをajaxで処理します。</p><pre><code>u(<span class="hljs-string">'.newsletter'</span>).ajax(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>{
  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> alert(<span class="hljs-string">'Error'</span>);
  alert(<span class="hljs-string">'Thank you for subscribing, awesome!'</span>);
});</code></pre><br><p>実際にajaxを使って送信します。</p><pre><code>u(<span class="hljs-string">'form.edit'</span>).ajax(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Sent!'</span>); }).trigger(<span class="hljs-string">'submit'</span>);</code></pre><br><h3>jQueryじゃダメなの？</h3><p>このパターンはjQueryでとても一般的な手法だったので、
<code>.ajax()</code>を作成しました。</p><pre><code>$(<span class="hljs-string">'form'</span>).on(<span class="hljs-string">'submit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{
  e.preventDefault();
  $.post($(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'action'</span>), $(<span class="hljs-keyword">this</span>).serialize(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>{
    alert(<span class="hljs-string">'Done! Thanks, '</span> + data.name);
  }, <span class="hljs-string">'json'</span>);
});</code></pre><br><p>上記のような手法を何度も使用していたので、
これをデフォルトにしておけば良いことに気づきました。
Umbrellaの場合、同様の処理を以下のように書きます。</p><pre><code>u(<span class="hljs-string">'form'</span>).ajax(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>)</span>{
  <span class="hljs-keyword">if</span> (!err) alert(<span class="hljs-string">'Done! Thanks, '</span> + data.name);
});</code></pre><br><p>もちろんこの書き方に強制力は無く、以下のようにjQueryと同様の指定方法も可能です。
しかし、今回の処理の場合、少し無意味だと思います。</p><pre><code>u(<span class="hljs-string">'form'</span>).on(<span class="hljs-string">'submit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{
  e.preventDefault();
  <span class="hljs-keyword">var</span> options = { <span class="hljs-attr">method</span>: u(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'method'</span>), <span class="hljs-attr">body</span>: u(<span class="hljs-keyword">this</span>).serialize() };
  ajax(u(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'action'</span>), options, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>)</span>{
    <span class="hljs-keyword">if</span> (!err) alert(<span class="hljs-string">'Done! Thanks, '</span> + data.name);
  });
});
</code></pre><h3>デモ</h3><p>"PUSH"ボタンを押すと、<code>console.log</code>に'Done! Thanks, Umbrella!!'と出力します。</p><form id="demo" action="../json/data.php" method="POST"><button type="submit">PUSH</button></form><h5>JavaScript</h5><pre><code>u(<span class="hljs-string">'#demo'</span>).ajax(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>)</span>{
  <span class="hljs-keyword">if</span> (!err) <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Done! Thanks, '</span> + data.name);
});</code></pre><h5>HTML</h5><pre><code><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"demo"</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"../json/data.php"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"POST"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>PUSH<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre><h5>PHP</h5><pre><code><span class="hljs-meta">&lt;?php</span>
header(<span class="hljs-string">'Content-Type: application/json'</span>);
<span class="hljs-keyword">echo</span> json_encode(<span class="hljs-keyword">array</span>(<span class="hljs-string">'name'</span> =&gt; <span class="hljs-string">'Umbrella!!'</span>));
<span class="hljs-keyword">exit</span>;</code></pre><br><h3>関連項目</h3><p><a class="no-barba" href="./ajax-fn.html"><code>ajax()</code></a> ajaxリクエストを処理します。</p><br><script class="load">createObj = function() {
  u('#demo').ajax(function(err, data){
    if (!err) console.log('Done! Thanks, ' + data.name);
  });
};</script><br><div class="license"><p>&copy; 2014
 Francisco Presencia Released under the <a href="https://github.com/franciscop/umbrella/blob/master/LICENSE">MIT license</a></p><p>このコンテンツはFrancisco Presencia(franciscop)による<a href="https://umbrellajs.com/">Umbrella JSドキュメント</a>を翻訳/改変したものです。</p></div></div></div></div></div><footer><span> &copy; <span id="copy_year">2017</span> tobijibu</span></footer></div><noscript id="deferred-styles"><link href="../css/lazy.css" rel="stylesheet"></noscript><script src="../js/main.js" defer></script><script src="https://unpkg.com/umbrellajs"></script><div id="src" hidden></div></body></html>